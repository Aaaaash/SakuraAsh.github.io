<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="æœ¬ç³»åˆ—æ–‡ç« ä¸ºMonaco-Editorç¼–è¾‘å™¨æŠ˜è…¾ã€è¸©å‘è®°å½•ï¼Œæ¶‰åŠåˆ°ååŒç¼–è¾‘ã€ä»£ç æç¤ºã€æ™ºèƒ½æ„ŸçŸ¥ç­‰åŠŸèƒ½çš„å®ç°ï¼Œä¸å®šæœŸæ›´æ–°  LanguageServerProtocolLanguageServerProtocol(ä»¥ä¸‹ç®€ç§°LSP)æ˜¯ç”±å¾®è½¯æå‡ºï¼Œå¹¶ä¸ Redhatã€Codenvyã€Sourcegraph ç­‰å…¬å¸è”åˆæ¨å‡ºçš„å¼€æºåè®®ã€‚ç”¨äºè¯­è¨€æœåŠ¡ç¨‹åºå‘ç¼–è¾‘å™¨ã€IDE ç­‰å·¥å…·æä¾›ä¸€ç³»åˆ—ä»£ç æç¤ºã€å®šä¹‰è·³è½¬ç­‰">
<meta name="keywords" content="monaco, ä»£ç æç¤º, ä»£ç è¯Šæ–­, LanguageServerProtocol">
<meta property="og:type" content="article">
<meta property="og:title" content="Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol">
<meta property="og:url" content="https://github.com/Aaaaash/2018/07/02/language-server/index.html">
<meta property="og:site_name" content="SakuraAsh&#39;s blog">
<meta property="og:description" content="æœ¬ç³»åˆ—æ–‡ç« ä¸ºMonaco-Editorç¼–è¾‘å™¨æŠ˜è…¾ã€è¸©å‘è®°å½•ï¼Œæ¶‰åŠåˆ°ååŒç¼–è¾‘ã€ä»£ç æç¤ºã€æ™ºèƒ½æ„ŸçŸ¥ç­‰åŠŸèƒ½çš„å®ç°ï¼Œä¸å®šæœŸæ›´æ–°  LanguageServerProtocolLanguageServerProtocol(ä»¥ä¸‹ç®€ç§°LSP)æ˜¯ç”±å¾®è½¯æå‡ºï¼Œå¹¶ä¸ Redhatã€Codenvyã€Sourcegraph ç­‰å…¬å¸è”åˆæ¨å‡ºçš„å¼€æºåè®®ã€‚ç”¨äºè¯­è¨€æœåŠ¡ç¨‹åºå‘ç¼–è¾‘å™¨ã€IDE ç­‰å·¥å…·æä¾›ä¸€ç³»åˆ—ä»£ç æç¤ºã€å®šä¹‰è·³è½¬ç­‰">
<meta property="og:updated_time" content="2018-07-02T10:04:11.569Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol">
<meta name="twitter:description" content="æœ¬ç³»åˆ—æ–‡ç« ä¸ºMonaco-Editorç¼–è¾‘å™¨æŠ˜è…¾ã€è¸©å‘è®°å½•ï¼Œæ¶‰åŠåˆ°ååŒç¼–è¾‘ã€ä»£ç æç¤ºã€æ™ºèƒ½æ„ŸçŸ¥ç­‰åŠŸèƒ½çš„å®ç°ï¼Œä¸å®šæœŸæ›´æ–°  LanguageServerProtocolLanguageServerProtocol(ä»¥ä¸‹ç®€ç§°LSP)æ˜¯ç”±å¾®è½¯æå‡ºï¼Œå¹¶ä¸ Redhatã€Codenvyã€Sourcegraph ç­‰å…¬å¸è”åˆæ¨å‡ºçš„å¼€æºåè®®ã€‚ç”¨äºè¯­è¨€æœåŠ¡ç¨‹åºå‘ç¼–è¾‘å™¨ã€IDE ç­‰å·¥å…·æä¾›ä¸€ç³»åˆ—ä»£ç æç¤ºã€å®šä¹‰è·³è½¬ç­‰">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/SakuraAsh">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/07/29/lsp-server/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/2018/05/01/Monaco-EditoræŠ˜è…¾è®°-å¤šäººååŒç¼–è¾‘çš„å®ç°/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://github.com/Aaaaash/2018/07/02/language-server/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://github.com/Aaaaash/2018/07/02/language-server/&text=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://github.com/Aaaaash/2018/07/02/language-server/&title=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://github.com/Aaaaash/2018/07/02/language-server/&is_video=false&description=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol&body=Check out this article: https://github.com/Aaaaash/2018/07/02/language-server/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://github.com/Aaaaash/2018/07/02/language-server/&title=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://github.com/Aaaaash/2018/07/02/language-server/&title=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://github.com/Aaaaash/2018/07/02/language-server/&title=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://github.com/Aaaaash/2018/07/02/language-server/&title=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://github.com/Aaaaash/2018/07/02/language-server/&name=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#LanguageServerProtocol"><span class="toc-number">1.</span> <span class="toc-text">LanguageServerProtocol</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ¦‚è§ˆ"><span class="toc-number">2.</span> <span class="toc-text">æ¦‚è§ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¦‚ä½•ä½¿-LSP-ä¸º-monaco-ç¼–è¾‘å™¨æä¾›æœåŠ¡"><span class="toc-number">3.</span> <span class="toc-text">å¦‚ä½•ä½¿ LSP ä¸º monaco ç¼–è¾‘å™¨æä¾›æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LanguageClient"><span class="toc-number">3.1.</span> <span class="toc-text">LanguageClient</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#é€šä¿¡æ–¹å¼"><span class="toc-number">3.2.</span> <span class="toc-text">é€šä¿¡æ–¹å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-ç«¯å¦‚ä½•å®ç°"><span class="toc-number">4.</span> <span class="toc-text">Web ç«¯å¦‚ä½•å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">5.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‚è€ƒèµ„æ–™"><span class="toc-number">6.</span> <span class="toc-text">å‚è€ƒèµ„æ–™</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">SakuraAsh's blog</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-07-02T02:57:20.000Z" itemprop="datePublished">2018-07-02</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/monaco-ä»£ç æç¤º-ä»£ç è¯Šæ–­-LanguageServerProtocol/">monaco, ä»£ç æç¤º, ä»£ç è¯Šæ–­, LanguageServerProtocol</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <blockquote>
<p>æœ¬ç³»åˆ—æ–‡ç« ä¸ºMonaco-Editorç¼–è¾‘å™¨æŠ˜è…¾ã€è¸©å‘è®°å½•ï¼Œæ¶‰åŠåˆ°ååŒç¼–è¾‘ã€ä»£ç æç¤ºã€æ™ºèƒ½æ„ŸçŸ¥ç­‰åŠŸèƒ½çš„å®ç°ï¼Œä¸å®šæœŸæ›´æ–°</p>
</blockquote>
<h2 id="LanguageServerProtocol"><a href="#LanguageServerProtocol" class="headerlink" title="LanguageServerProtocol"></a>LanguageServerProtocol</h2><p><a href="https://microsoft.github.io/language-server-protocol/" target="_blank" rel="noopener">LanguageServerProtocol</a>(ä»¥ä¸‹ç®€ç§°LSP)æ˜¯ç”±å¾®è½¯æå‡ºï¼Œå¹¶ä¸ Redhatã€Codenvyã€Sourcegraph ç­‰å…¬å¸è”åˆæ¨å‡ºçš„å¼€æºåè®®ã€‚ç”¨äºè¯­è¨€æœåŠ¡ç¨‹åºå‘ç¼–è¾‘å™¨ã€IDE ç­‰å·¥å…·æä¾›ä¸€ç³»åˆ—ä»£ç æç¤ºã€å®šä¹‰è·³è½¬ç­‰åŠŸèƒ½çš„é€šç”¨åè®®ã€‚å®ƒå°†é«˜çº§è¯­è¨€ç›¸å…³çš„ä¸€äº›åŠŸèƒ½ç‰¹æ€§ä»ä¼ ç»Ÿ IDE ä¸­æŠ½è±¡å‡ºä¸€ä¸ªå•ç‹¬çš„ç¨‹åºæ¥è¿è¡Œï¼ŒLSP å®šä¹‰äº†ä¸€å¥—é€šç”¨çš„APIï¼Œéµå¾ªLSPåè®®å®ç°æŸä¸ªè¯­è¨€çš„ç‰¹æ€§åŠŸèƒ½åï¼Œç¼–è¾‘å™¨åªéœ€è¦è°ƒç”¨è¯¥è¯­è¨€çš„ LanguageServer ï¼Œå³å¯å®ç°ä»£ç æç¤ºã€å®šä¹‰è·³è½¬ã€ä»£ç è¯Šæ–­ç­‰åŠŸèƒ½ã€‚</p>
<p>ä¼ ç»Ÿçš„IDEæˆ–ç¼–è¾‘å™¨è¦å®ç°è¯¸å¦‚æ™ºèƒ½æç¤ºã€è‡ªåŠ¨è¡¥å…¨ç­‰åŠŸèƒ½ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„IDEæ¥å¼€å‘ç›¸åº”è¯­è¨€çš„ç‰¹æ€§åŠŸèƒ½ç¨‹åºï¼Œå¤šä¸ª IDE è¦æƒ³æ”¯æŒå¤šç§é«˜çº§è¯­è¨€ï¼Œä¸”æ¯ä¸ª IDE çš„å…·ä½“å®ç°åŠ API å¯èƒ½éƒ½å¤§ä¸ç›¸åŒï¼Œå¼€å‘æˆæœ¬éå¸¸é«˜ã€‚LSPçš„å‡ºç°åˆ™å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼ŒN ä¸ª IDE å’Œ M ä¸ªè¯­è¨€ï¼Œåªéœ€è¦å¼€å‘ä¸€æ¬¡ç›¸åº”è¯­è¨€çš„è¯­è¨€æœåŠ¡å™¨ç¨‹åºå³å¯åœ¨æ¯ä¸ªIDEä¸­ä½¿ç”¨ã€‚</p>
<p><a href="https://github.com/Microsoft/language-server-protocol/wiki/Protocol-History">LanguageServerProtocolèµ·æº</a></p>
<h2 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h2><p>LSPä½¿ç”¨<a href="http://www.jsonrpc.org/" target="_blank" rel="noopener">JSON-RPC</a>åè®®ä½œä¸º Server/Client é€šä¿¡çš„æ¶ˆæ¯æ ¼å¼ï¼Œä¸”æ”¯æŒ TCPã€Stdin/Stdout è¿›è¡Œæ¶ˆæ¯ä¼ è¾“ï¼Œæ‰€ä»¥å®ƒå³å¯ä»¥è¿è¡Œåœ¨æœ¬åœ°å®¢æˆ·ç«¯ï¼Œä¹Ÿå¯ä»¥è¿è¡Œåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚<br>æˆªè‡³ç›®å‰ LSP ç‰ˆæœ¬ä¸º3.8ï¼Œå®ç°äº†æ•°åä¸ªæ–¹æ³•(å…·ä½“æ²¡æ•°ğŸ˜†)ï¼Œéƒ¨åˆ†ä¸»æµ IDE/ç¼–è¾‘å™¨ä¹Ÿå·²ç»æ”¯æŒäº† LSP ï¼ŒåŒ…æ‹¬ Eclipseã€VScodeã€Sublime Text &amp; Sublime Text 3ã€Atom ç­‰ã€‚</p>
<p>LSPåè®®åŸºæœ¬æ¶ˆæ¯æ ¼å¼ç”± <code>header</code> ä¸ <code>content</code> ç»„æˆï¼Œä¸­é—´ä½¿ç”¨<code>\r\n</code>ä½œä¸ºåˆ†éš”ç¬¦ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Content-length: ... \r\n</span><br><span class="line">\r\n</span><br><span class="line">&#123;</span><br><span class="line">	&quot;jsonrpc&quot;: &quot;2.0&quot;,</span><br><span class="line">	&quot;id&quot;: 1,</span><br><span class="line">	&quot;method&quot;: &quot;textDocument/didOpen&quot;,</span><br><span class="line">	&quot;params&quot;: &#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>LSPæ¶ˆæ¯å¤§ä½“æ¥è¯´åˆ†ä¸ºä¸‰ç§ç±»å‹</p>
<ul>
<li>é€šçŸ¥ (Notifiction)</li>
<li>è¯·æ±‚ (Request)</li>
<li>æ—¥å¿—åŠé”™è¯¯ä¿¡ (LogMessage/ShowMessage)</li>
</ul>
<p>é€šä¿¡æ˜¯åŒå‘çš„ï¼ŒClient å¯ä»¥å‘ Server å‘é€è¯·æ±‚/é€šçŸ¥ï¼Œæ¯”å¦‚æ‰“å¼€æ–‡ä»¶ã€ä¿®æ”¹æ–‡æ¡£å†…å®¹ç­‰ã€‚ Server ä¹Ÿå¯ä»¥å‘ Client å‘é€è¯·æ±‚/é€šçŸ¥ï¼Œæ¯”å¦‚åŠ¨æ€æ³¨å†Œå®¢æˆ·ç«¯åŠŸèƒ½ã€‚æ¯ä¸ªè¯·æ±‚éœ€è¦ä½¿ç”¨ <code>id</code> ä¸ºå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¯¹è¿™ä¸ªè¯·æ±‚çš„è¿”å›å€¼ä¹Ÿåº”å½“åŒ…å«è¿™ä¸ª idï¼Œä¸€èˆ¬æ¥è¯´ id ä¸ºé€’å¢çš„æ•°å­—ã€‚<br>LSPçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>Client å‘é€ <code>initialize</code> è¯·æ±‚ï¼ŒåŒ…å«ä¸€äº›åˆå§‹åŒ–å‚æ•°ã€‚Server æ”¶åˆ°è¯·æ±‚åå¼€å§‹å‡†å¤‡å¯åŠ¨è¯­è¨€æœåŠ¡ï¼Œä¹‹å Server ä¼šå‘é€ <code>initialized</code> é€šçŸ¥åˆ°å®¢æˆ·ç«¯ï¼Œè¯­è¨€æœåŠ¡å¼€å§‹å·¥ä½œã€‚</p>
</li>
<li><p>åˆå§‹åŒ–æˆåŠŸå Server å¯èƒ½ä¼šå‘ Client å‘é€ä¸€äº›åŠ¨æ€æ³¨å†ŒåŠŸèƒ½çš„è¯·æ±‚ <code>client/registerCapability</code>ã€‚</p>
</li>
<li><p>æ¯æ¬¡æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œ Client éœ€è¦å‘ Server å‘é€ä¸€ä¸ª <code>textDocument/didOpen</code> è¯·æ±‚ï¼Œæºå¸¦æ–‡ä»¶ <a href="https://tools.ietf.org/html/rfc3986" target="_blank" rel="noopener">URI</a> å‚æ•°ã€‚åŒç†å…³é—­æ–‡ä»¶åè¦å‘é€ä¸€ä¸ª <code>textDocument/didClose</code> è¯·æ±‚ã€‚</p>
</li>
<li><p>ç¼–è¾‘æ–‡æ¡£æ—¶ï¼Œå½“è¾“å…¥<code>.</code>æˆ–æŒ‰ä¸‹è¯­æ³•æç¤ºå¿«æ·é”®æ—¶ï¼Œ Client å‘é€ <code>textDocument/completion</code> è¯·æ±‚æ¥è·å–æ™ºèƒ½æç¤ºåˆ—è¡¨ã€‚</p>
</li>
<li><p>å½“ç”¨æˆ·æŸ¥è¯¢æŸä¸ªç±»/å˜é‡/æ–¹æ³•çš„å£°æ˜æ—¶ï¼ˆç‚¹å‡»è·³è½¬ï¼‰ï¼ŒClient å‘é€ <code>textDocument/definition</code> ï¼ŒServer å°†è¿”å›å¯¹åº”çš„æ–‡ä»¶ URI åŠä½ç½®ä¿¡æ¯ã€‚Client éœ€è¦å®ç°æ‰“å¼€è¿™ä¸ªæ–°æ–‡ä»¶çš„æ–¹æ³•ã€‚</p>
</li>
<li><p>å½“ç”¨æˆ·å…³é—­ç¼–è¾‘å™¨æ—¶ï¼ŒClient å…ˆå‘é€ <code>shutdown</code> è¯·æ±‚ï¼ŒServer æ”¶åˆ°è¯·æ±‚åä¼šç«‹å³å…³é—­ä½†å¹¶ä¸ä¼šé€€å‡ºè¿›ç¨‹ï¼Œè€Œæ˜¯ç­‰å¾… Client å‘é€ <code>exit</code> é€šçŸ¥ã€‚</p>
</li>
</ul>
<h2 id="å¦‚ä½•ä½¿-LSP-ä¸º-monaco-ç¼–è¾‘å™¨æä¾›æœåŠ¡"><a href="#å¦‚ä½•ä½¿-LSP-ä¸º-monaco-ç¼–è¾‘å™¨æä¾›æœåŠ¡" class="headerlink" title="å¦‚ä½•ä½¿ LSP ä¸º monaco ç¼–è¾‘å™¨æä¾›æœåŠ¡"></a>å¦‚ä½•ä½¿ LSP ä¸º monaco ç¼–è¾‘å™¨æä¾›æœåŠ¡</h2><p>è™½ç„¶ monaco ç¼–è¾‘å™¨è„±èƒäº VScode ï¼Œä½†å…¶åªæ˜¯ä¸€ä¸ªç¼–è¾‘å™¨å®ç°ï¼Œæ²¡æœ‰æ–‡ä»¶æ ‘ï¼Œå¤šæ ‡ç­¾é¡µæ”¯æŒã€‚åŒæ—¶ VScode æ˜¯åŸºäº Electron çš„æ¡Œé¢ç«¯åº”ç”¨ï¼Œè‡ªå¸¦ Nodejs ç¯å¢ƒï¼Œå¯ä»¥åˆ©ç”¨ TCP æˆ– Stdin/Stdout æ¥å¼€å¯è¯­è¨€æœåŠ¡ï¼Œè™½ç„¶ VScode å›¢é˜Ÿå¼€æºäº†ä¸€äº› LSP ç›¸å…³çš„åº“ï¼Œä½†ç”±äºè¿è¡Œç¯å¢ƒçš„å·¨å¤§å·®å¼‚ï¼Œåœ¨ Web ç«¯å¹¶ä¸èƒ½ç›´æ¥åº”ç”¨ã€‚</p>
<h3 id="LanguageClient"><a href="#LanguageClient" class="headerlink" title="LanguageClient"></a>LanguageClient</h3><p>è¦åœ¨ VScode ä¸­ä½“éªŒ LSPï¼Œ éœ€è¦å…ˆä¸‹è½½å®‰è£… <a href="https://github.com/redhat-developer/vscode-java">vscode-java</a> æ’ä»¶ã€‚è¿™ä¸ªæ’ä»¶ç”± redhat-developer å›¢é˜Ÿå¼€æºï¼Œä½¿ç”¨ TypeScript åŠ JavaScript ç¼–å†™ï¼Œä¸»è¦ä½œç”¨æ˜¯ä¸‹è½½å’Œæ„å»º <a href="https://github.com/eclipse/eclipse.jdt.ls">eclipse.jdt.ls</a> ç¨‹åº, ä»¥åŠåˆ›å»º LanguageClient ä½¿ VScode èƒ½å¤Ÿå¯åŠ¨ LSPã€‚ eclipse.jdt.ls å°±æ˜¯ eclipse å¼€å‘çš„ Java è¯­è¨€æœåŠ¡å™¨ LSP å®ç°ã€‚</p>
<p>LanguageClient ç±»ç”± VScode å›¢é˜Ÿå¼€æºçš„ <a href="https://www.npmjs.com/package/vscode-languageclient" target="_blank" rel="noopener">vscode-languageclient</a> åº“æä¾›ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯æ ¹æ®ä¼ å…¥çš„é…ç½®è¿æ¥åˆ°æŒ‡å®šè¯­è¨€çš„ LSPï¼Œå¹¶å¯¹ LSP æ”¯æŒçš„å„ç§æ–¹æ³•åšä¸€å±‚å°è£…ï¼Œè¿˜åŒ…å«äº†æœ¬åœ°è¿è¡Œ LSP ç¨‹åºæ—¶å¯¹ TCP æ¶ˆæ¯è¿›è¡Œç²˜åŒ…å¤„ç†çš„åŠŸèƒ½ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; LanguageClient, LanguageClientOptions, ServerOptions &#125; <span class="keyword">from</span> <span class="string">'vscode-language-client'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clientOptions: LanguageClientOptions = &#123;</span><br><span class="line">  documentSelector: [</span><br><span class="line">    &#123; scheme: <span class="string">'file'</span>, language: <span class="string">'java'</span> &#125;,</span><br><span class="line">    &#123; scheme: <span class="string">'jdt'</span>, language: <span class="string">'java'</span> &#125;,</span><br><span class="line">    &#123; scheme: <span class="string">'untitled'</span>, language: <span class="string">'java'</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  synchronize: &#123;</span><br><span class="line">    configurationSection: <span class="string">'java'</span>,</span><br><span class="line">    fileEvents: [</span><br><span class="line">      workspace.createFileSystemWatcher(<span class="string">'**/*.java'</span>),</span><br><span class="line">      workspace.createFileSystemWatcher(<span class="string">'**/pom.xml'</span>),</span><br><span class="line">      workspace.createFileSystemWatcher(<span class="string">'**/*.gradle'</span>),</span><br><span class="line">      workspace.createFileSystemWatcher(<span class="string">'**/.project'</span>),</span><br><span class="line">      workspace.createFileSystemWatcher(<span class="string">'**/.classpath'</span>),</span><br><span class="line">      workspace.createFileSystemWatcher(<span class="string">'**/settings/*.prefs'</span>),</span><br><span class="line">      workspace.createFileSystemWatcher(<span class="string">'**/src/**'</span>)</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serverOptions: ServerOptions = &#123;</span><br><span class="line">  command: <span class="string">'java'</span>,</span><br><span class="line">  args: [</span><br><span class="line">    <span class="comment">// jdt.ls å¯åŠ¨å‚æ•°</span></span><br><span class="line">  ],</span><br><span class="line">  options: &#123;</span><br><span class="line">    <span class="comment">// ç›¸å…³é…ç½®</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> LanguageClient(&#123;</span><br><span class="line">  <span class="string">'java'</span>,</span><br><span class="line">  <span class="string">'Language Support for Java'</span>,</span><br><span class="line">  serverOptions,</span><br><span class="line">  clientOptions,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">client.start();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ä¸ªåº“æºä»£ç å®é™…åŒ…å«åœ¨ <a href="https://github.com/Microsoft/vscode-languageserver-node">vscode-languageserver-node</a> ä¸­ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯ VScode å›¢é˜Ÿå®ç° Nodejs çš„ LSP å®¢æˆ·ç«¯/æœåŠ¡ç«¯åè§‰å¾—å®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ªé€šç”¨çš„å®¢æˆ·ç«¯å®ç°ï¼Œæ‰€ä»¥å•ç‹¬å‘å¸ƒåˆ°äº† npm ä¸Šã€‚</p>
</blockquote>
<h3 id="é€šä¿¡æ–¹å¼"><a href="#é€šä¿¡æ–¹å¼" class="headerlink" title="é€šä¿¡æ–¹å¼"></a>é€šä¿¡æ–¹å¼</h3><p>ä¹‹å‰è¯´è¿‡ï¼ŒLSP æ”¯æŒ TCP å’Œ Stdin/out æ¥å’Œå®¢æˆ·ç«¯é€šä¿¡ã€‚</p>
<ul>
<li><p>å¦‚æœæ˜¯ä»¥ TCP çš„æ–¹å¼ï¼Œ jdt.ls å¯åŠ¨æ—¶éœ€è¦æŒ‡å®šä¸€ä¸ª <code>CLIENT_PORT</code> å‚æ•°è¡¨æ˜ TCP æœåŠ¡çš„ç«¯å£ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä»¥ TCP æ¨¡å¼å¯åŠ¨ jdt.jsï¼ŒLSP æ˜¯ä½œä¸º TCP å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥éœ€è¦å†å¼€å¯ä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œä¹‹å jdt.ls æ‰ä¼šè¿æ¥åˆ°æŒ‡å®šç«¯å£çš„æœåŠ¡ä¸Šè¿›è¡Œé€šä¿¡ã€‚</p>
</li>
<li><p>å¦‚æœæ˜¯ä»¥ Stdin/Stdout å¯åŠ¨ï¼Œåˆ™åªéœ€è¦ä½¿ç”¨ Nodejs çš„ Childprocess å¼€å¯ä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶ååˆ©ç”¨æ ‡å‡†è¾“å…¥è¾“å‡ºä¸ Client é€šä¿¡ã€‚</p>
</li>
</ul>
<h2 id="Web-ç«¯å¦‚ä½•å®ç°"><a href="#Web-ç«¯å¦‚ä½•å®ç°" class="headerlink" title="Web ç«¯å¦‚ä½•å®ç°"></a>Web ç«¯å¦‚ä½•å®ç°</h2><p>æµè§ˆå™¨æ˜¯ä¸€ä¸ªå°é—­çš„ç¯å¢ƒï¼Œå®ƒåªèƒ½æ“ä½œ DOM ï¼Œæ‰€ä»¥è¦æƒ³åœ¨æµè§ˆå™¨ä¸­ä¸º monaco ç¼–è¾‘å™¨æä¾› LSP æœåŠ¡ï¼Œå¿…é¡»è¦æŠŠ LSP è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šã€‚</p>
<p>ç”±äº LSP å’Œ monaco æœ¬èº«å°±æ˜¯åŒä¸€ä¸ªå›¢é˜Ÿå¼€å‘çš„ï¼Œæ‰€ä»¥ jdt.ls çš„å®ç°ä¹Ÿå¯ä»¥å®Œç¾å…¼å®¹ monacoã€‚æˆ‘ä»¬ä½¿ç”¨ webSocket ä¸æœåŠ¡ç«¯é€šä¿¡ï¼Œç”±äºæµè§ˆå™¨ç«¯çš„é™åˆ¶ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥ä½¿ç”¨ vscode-languageclient ï¼Œå¹¸å¥½ typefox å›¢é˜ŸåŸºäº vscode-languageclient å¼€å‘äº†ä½¿ç”¨äºæµè§ˆå™¨ç«¯çš„é€‚é…å™¨ <a href="https://github.com/TypeFox/monaco-languageclient">monaco-languageclient</a>ã€‚å€ŸåŠ©è¿™ä¸ªåº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ webSocket è½»æ¾çš„è¿æ¥è¿œç«¯ LSP æœåŠ¡ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createMonacoServices &#125; <span class="keyword">from</span> <span class="string">'monaco-languageclient'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; listen, MessageConnection &#125; <span class="keyword">from</span> <span class="string">'vscode-ws-jsonrpc'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> monaco <span class="keyword">from</span> <span class="string">'monaco-editor'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> editor = monaco.editor.create(root, &#123;</span><br><span class="line">  model: monaco.editor.createModel(value, <span class="string">'java'</span>, monaco.Uri.parse(<span class="string">`file://javademo/Hello.java`</span>)),</span><br><span class="line">  theme: <span class="string">'vs-dark'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">'ws://127.0.0.1/java-lsp'</span>;</span><br><span class="line"><span class="comment">// åˆ›å»º servicesï¼Œå‘ç¼–è¾‘å™¨æ³¨å†Œä¸€ç³»åˆ—å‘½ä»¤</span></span><br><span class="line"><span class="keyword">const</span> services = createMonacoServices(editor, &#123; rootUri: <span class="string">`file://javademo`</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> webSocket = <span class="keyword">new</span> WebSocket(url);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ webSocket è¿æ¥ï¼Œè¿æ¥æˆåŠŸååˆ›å»ºå®¢æˆ·ç«¯å¹¶å¯åŠ¨</span></span><br><span class="line">listen(&#123;</span><br><span class="line">  webSocket,</span><br><span class="line">  onConnection: <span class="function">(<span class="params">connection: MessageConnection</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> languageClient = createLanguageClient(connection);</span><br><span class="line">    <span class="keyword">const</span> disposable = languageClient.start();</span><br><span class="line">    connection.onClose(<span class="function"><span class="params">()</span> =&gt;</span> disposable.dispose());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createLanguageClient</span>(<span class="params">connection: MessageConnection</span>): <span class="title">BaseLanguageClient</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> BaseLanguageClient(&#123;</span><br><span class="line">    name: <span class="string">"Java LSP client"</span>,</span><br><span class="line">    clientOptions: &#123;</span><br><span class="line">      documentSelector: [<span class="string">'java'</span>],</span><br><span class="line">      errorHandler: &#123;</span><br><span class="line">        error: <span class="function"><span class="params">()</span> =&gt;</span> ErrorAction.Continue,</span><br><span class="line">        closed: <span class="function"><span class="params">()</span> =&gt;</span> CloseAction.DoNotRestart</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    services,</span><br><span class="line">    connectionProvider: &#123;</span><br><span class="line">      <span class="keyword">get</span>: <span class="function">(<span class="params">errorHandler, closeHandler</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(createConnection(connection, errorHandler, closeHandler))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬è¿˜ä½¿ç”¨äº†ä¸€ä¸ªåº“ <code>vscode-ws-jsonrpc</code>ï¼Œè¿™ä¹Ÿæ˜¯ typefox å›¢é˜Ÿæ ¹æ®åŸ VScode çš„ <code>vscode-jsonrpc</code> ä¿®æ”¹è€Œæ¥ã€‚åŸæœ¬çš„ <code>vscode-jsonrpc</code> å¹¶ä¸æ”¯æŒ WebSocketï¼Œæ‰€ä»¥å¯¹å®ƒè¿›è¡Œäº†æ‰©å±•ä»¥æ”¯æŒæµè§ˆå™¨ç«¯ã€‚</p>
<p>åœ¨æœåŠ¡ç«¯æˆ‘ä»¬éœ€è¦ç”¨ Nodejs çš„ Childprocess å¯åŠ¨ jdt.lsï¼ŒåŒæ—¶è¿˜è¦å†å¼€å¯ä¸€ä¸ª webSocket æœåŠ¡å™¨ã€‚ç›‘å¬ websocket çš„ onmessage äº‹ä»¶ï¼Œå°† data é€šè¿‡ stdin å‘é€ç»™ LSP, å†ç›‘å¬ stdout çš„ ondata äº‹ä»¶ï¼Œå°†è¿”å›ç»“æœé€šè¿‡ webSocket å‘é€åˆ°æµè§ˆå™¨ç«¯ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> cp <span class="keyword">from</span> <span class="string">'child-process'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> express <span class="keyword">from</span> <span class="string">'express'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> glob <span class="keyword">from</span> <span class="string">'glob'</span>;</span><br><span class="line"><span class="keyword">import</span> WebSocket <span class="keyword">from</span> <span class="string">'ws'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CONFIG_DIR = process.platform === <span class="string">'darwin'</span> ? <span class="string">'config_mac'</span> : process.platform === <span class="string">'linux'</span> ? <span class="string">'config_linux'</span> : <span class="string">'config_win'</span>;</span><br><span class="line"><span class="keyword">const</span> BASE_URI = <span class="string">'/data/eclipse.jdt.ls/server'</span>;</span><br><span class="line"><span class="keyword">type</span> IJavaExecutable = &#123;</span><br><span class="line">  options: <span class="built_in">any</span>;</span><br><span class="line">  command: <span class="built_in">string</span>;</span><br><span class="line">  args: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = <span class="number">9988</span>;</span><br><span class="line"><span class="keyword">const</span> SERVER_HOME = <span class="string">'lsp-java-server'</span>;</span><br><span class="line"><span class="keyword">const</span> launchersFound: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt; = glob.sync(<span class="string">'**/plugins/org.eclipse.equinox.launcher_*.jar'</span>, &#123; cwd: <span class="string">`./<span class="subst">$&#123;SERVER_HOME&#125;</span>`</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (launchersFound.length === <span class="number">0</span> || !launchersFound) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'**/plugins/org.eclipse.equinox.launcher_*.jar Not Found!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt; = [</span><br><span class="line">  <span class="string">'-Xmx256m'</span>,</span><br><span class="line">  <span class="string">'-Xms256m'</span>,</span><br><span class="line">  <span class="string">'-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=,quiet=y'</span>,</span><br><span class="line">  <span class="string">'-Declipse.application=org.eclipse.jdt.ls.core.id1'</span>,</span><br><span class="line">  <span class="string">'-Dosgi.bundles.defaultStartLevel=4'</span>,</span><br><span class="line">  <span class="string">'-noverify'</span>,</span><br><span class="line">  <span class="string">'-Declipse.product=org.eclipse.jdt.ls.core.product'</span>,</span><br><span class="line">  <span class="string">'-jar'</span>,</span><br><span class="line">  <span class="string">`<span class="subst">$&#123;BASE_URI&#125;</span>/<span class="subst">$&#123;launchersFound[0]&#125;</span>`</span>,</span><br><span class="line">  <span class="string">'-configuration'</span>,</span><br><span class="line">  <span class="string">`<span class="subst">$&#123;BASE_URI&#125;</span>/<span class="subst">$&#123;CONFIG_DIR&#125;</span>`</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">prepareExecutable</span>(<span class="params"></span>): <span class="title">IJavaExecutable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> executable = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">let</span> options = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">  options.env = process.env;</span><br><span class="line">  options.stdio = <span class="string">'pipe'</span>;</span><br><span class="line">  executable.options = options;</span><br><span class="line">  executable.command = <span class="string">'java'</span>;</span><br><span class="line">  executable.args = params;</span><br><span class="line">  <span class="keyword">return</span> executable;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> executable = prepareExecutable();</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> server = app.listen(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> WebSocket.Server(&#123;</span><br><span class="line">  noServer: <span class="literal">true</span>,</span><br><span class="line">  perMessageDeflate: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'upgrade'</span>, <span class="function">(<span class="params">request: http.IncomingMessage, socket: net.Socket, head: Buffer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> pathname = request.url ? url.parse(request.url).pathname : <span class="literal">undefined</span>;</span><br><span class="line">    <span class="keyword">if</span> (pathname === <span class="string">'/java-lsp'</span>) &#123;</span><br><span class="line">        wss.handleUpgrade(request, socket, head, <span class="function"><span class="params">webSocket</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> socket: rpc.IWebSocket = &#123;</span><br><span class="line">                send: <span class="function"><span class="params">content</span> =&gt;</span> webSocket.send(content, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> error;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;),</span><br><span class="line">                onMessage: <span class="function"><span class="params">cb</span> =&gt;</span> webSocket.on(<span class="string">'message'</span>, cb),</span><br><span class="line">                onError: <span class="function"><span class="params">cb</span> =&gt;</span> webSocket.on(<span class="string">'error'</span>, cb),</span><br><span class="line">                onClose: <span class="function"><span class="params">cb</span> =&gt;</span> webSocket.on(<span class="string">'close'</span>, cb),</span><br><span class="line">                dispose: <span class="function"><span class="params">()</span> =&gt;</span> webSocket.close()</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> (webSocket.readyState === webSocket.OPEN) &#123;</span><br><span class="line">                launch(socket);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                webSocket.on(<span class="string">'open'</span>, <span class="function"><span class="params">()</span> =&gt;</span> launch(socket));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">launch</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> process = cp.spawn(executable.command, executable.args);</span><br><span class="line">  </span><br><span class="line">  sockt.onMessage(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    process.stdin.write(data)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  process.stdout.on(<span class="string">'data'</span>, <span class="function">(<span class="params">respose</span>) =&gt;</span> &#123;</span><br><span class="line">    socket.send(respose)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>webSocket æœåŠ¡å™¨å®é™…ä½œä¸ºä¸€ä¸ªä¸­è½¬å±‚ï¼Œå°†æµè§ˆå™¨ä¸ LSP è¿æ¥èµ·æ¥ï¼Œè¿™æ ·å°±å®ç°äº†æœ€åŸºæœ¬çš„è¯­è¨€æœåŠ¡è¿æ¥ã€‚<br>é™¤æ­¤ä¹‹å¤–ï¼Œjdt.ls è¿˜æ”¯æŒ maven é¡¹ç›®çš„åŸç”Ÿæ”¯æŒä»¥åŠ gradle é¡¹ç›®çš„æœ‰é™æ”¯æŒï¼ˆä¸æ”¯æŒ Android ï¼‰é¡¹ç›®ï¼Œå®¢æˆ·ç«¯è¿˜éœ€è¦å®ç°æ–‡ä»¶ç›‘æ§åŠŸèƒ½ï¼Œå½“ <code>pom.xml</code>ã€<code>budile.gradle</code> ç­‰æ„å»ºå·¥å…·ç›¸å…³é…ç½®æ–‡ä»¶å‘ç”Ÿæ”¹å˜æ—¶è¯­è¨€æœåŠ¡ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–ä¿®æ”¹é¡¹ç›®é…ç½®ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä»‹ç»äº† LanguageServerProtocol çš„åŸºæœ¬æ¦‚å¿µåŠç¼–è¾‘å™¨ä¸ LSP çš„ç®€å•äº¤äº’æµç¨‹ï¼Œäº†è§£äº† VScode å¦‚ä½•åˆ©ç”¨ LSP å®ç°ä»£ç æç¤ºã€æ™ºèƒ½æ„ŸçŸ¥ã€è‡ªåŠ¨å®Œæˆç­‰åŠŸèƒ½ï¼Œæœ€ååœ¨ Web ç«¯å®ç°äº†ç¼–è¾‘å™¨ä¸ LSP æœåŠ¡çš„ç®€å•è¿æ¥ã€‚LSP æ‰“ç ´äº†ä¼ ç»Ÿ IDE é‡å¤å®ç°å¤šæ¬¡è¯­è¨€ç‰¹æ€§åŠŸèƒ½çš„å°´å°¬å±€é¢ï¼Œå¹¶åœ¨ VScode ä¸Šåšäº†éå¸¸å¥½çš„å®è·µï¼Œæ–‡ä¸­ä½¿ç”¨çš„ <code>eclipse.jdt.ls</code> è¯­è¨€æœåŠ¡å™¨å·²ç»åœ¨ <a href="https://studio.coding.net/ws/default" target="_blank" rel="noopener">Cloud Studio 2.0</a> ç‰ˆæœ¬æ­£å¼ä¸Šçº¿ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥ç‚¹å‡»åˆ›å»ºä¸€ä¸ª Java é¡¹ç›®è¯•ç”¨ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://microsoft.github.io/language-server-protocol/" target="_blank" rel="noopener">language-server-protocol</a></li>
<li><a href="https://typefox.io/teaching-the-language-server-protocol-to-microsofts-monaco-editor" target="_blank" rel="noopener">teaching-the-language-server-protocol-to-microsofts-monaco-editor</a></li>
<li><a href="https://github.com/eclipse/eclipse.jdt.ls">eclipse.jdt.ls</a></li>
</ul>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/SakuraAsh">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#LanguageServerProtocol"><span class="toc-number">1.</span> <span class="toc-text">LanguageServerProtocol</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ¦‚è§ˆ"><span class="toc-number">2.</span> <span class="toc-text">æ¦‚è§ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¦‚ä½•ä½¿-LSP-ä¸º-monaco-ç¼–è¾‘å™¨æä¾›æœåŠ¡"><span class="toc-number">3.</span> <span class="toc-text">å¦‚ä½•ä½¿ LSP ä¸º monaco ç¼–è¾‘å™¨æä¾›æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LanguageClient"><span class="toc-number">3.1.</span> <span class="toc-text">LanguageClient</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#é€šä¿¡æ–¹å¼"><span class="toc-number">3.2.</span> <span class="toc-text">é€šä¿¡æ–¹å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-ç«¯å¦‚ä½•å®ç°"><span class="toc-number">4.</span> <span class="toc-text">Web ç«¯å¦‚ä½•å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">5.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‚è€ƒèµ„æ–™"><span class="toc-number">6.</span> <span class="toc-text">å‚è€ƒèµ„æ–™</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://github.com/Aaaaash/2018/07/02/language-server/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://github.com/Aaaaash/2018/07/02/language-server/&text=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://github.com/Aaaaash/2018/07/02/language-server/&title=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://github.com/Aaaaash/2018/07/02/language-server/&is_video=false&description=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol&body=Check out this article: https://github.com/Aaaaash/2018/07/02/language-server/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://github.com/Aaaaash/2018/07/02/language-server/&title=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://github.com/Aaaaash/2018/07/02/language-server/&title=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://github.com/Aaaaash/2018/07/02/language-server/&title=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://github.com/Aaaaash/2018/07/02/language-server/&title=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://github.com/Aaaaash/2018/07/02/language-server/&name=Monaco-EditoræŠ˜è…¾è®°--LanguageServerProtocol&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 SakuraAsh
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/SakuraAsh">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">


<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


